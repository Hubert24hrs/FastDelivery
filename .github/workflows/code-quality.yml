name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  quality-checks:
    name: Code Quality Checks
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'
          channel: 'stable'
          cache: true
      
      - name: Get dependencies
        run: flutter pub get
      
      - name: Check for outdated packages
        run: flutter pub outdated
        continue-on-error: true
      
      - name: Run dart analyze
        run: flutter analyze > analyze_report.txt
        continue-on-error: true
      
      - name: Check for breaking changes
        run: |
          if grep -q "error" analyze_report.txt; then
            echo "âš ï¸ Found errors in analysis"
            cat analyze_report.txt
            exit 1
          else
            echo "âœ… No analysis errors found"
          fi
      
      - name: Verify pubspec.yaml
        run: |
          if [ -f pubspec.yaml ]; then
            echo "âœ… pubspec.yaml found"
          else
            echo "âŒ pubspec.yaml not found"
            exit 1
          fi
      
      - name: Check code metrics
        run: |
          echo "ðŸ“Š Code Statistics:"
          echo "Total Dart files: $(find lib -name '*.dart' | wc -l)"
          echo "Total lines of code: $(find lib -name '*.dart' -exec wc -l {} + | tail -1 | awk '{print $1}')"
          echo "Test files: $(find test -name '*_test.dart' 2>/dev/null | wc -l || echo 0)"
